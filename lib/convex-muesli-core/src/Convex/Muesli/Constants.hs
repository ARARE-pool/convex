{-# LANGUAGE DerivingStrategies #-}
{-# LANGUAGE GADTs              #-}
{-# LANGUAGE NumericUnderscores #-}
{-# LANGUAGE OverloadedStrings  #-}
{-# LANGUAGE TypeApplications   #-}
{-# LANGUAGE ViewPatterns       #-}
{-| Constants related to the muesli contract.
-}
module Convex.Muesli.Constants(
  muesliAddr,
  muesliHash,
  muesliStart,
  muesliScript,
  minDepositLovelace,
  handlingFeeLovelace,
  fullMatchRedeemer,
  getStakingKey,
  -- * Versions of the muesli script
  MuesliVersion(..),
  muesliVersion,
  -- * Some transactions used for debugging
  -- ** Interesting tx 0
  interestingTx0,
  interestingTx0TxEvents,
  interestingTx0Tx,
  -- ** Interesting tx 1
  interestingTx1,
  interestingTx1TxEvents,
  -- ** Interesting tx 2
  interestingTx2,
  interestingTx2Tx,
  interestingTx2TxEvents,
  -- ** First dangling match tx
  -- *** The transaction
  firstDanglingMatchTx,
  firstDanglingMatchTxTx,
  firstDanglingMatchTxEvents,
  -- *** Its inputs
  firstDanglingMatchScriptInput1,
  firstDanglingMatchScriptInput1Tx,
  firstDanglingMatchScriptInput1TxEvents,
  firstDanglingMatchScriptInput2,
  firstDanglingMatchScriptInput2Tx,
  firstDanglingMatchScriptInput2TxEvents
  ) where


import Cardano.Api (Address, AsType (AsHash), BlockHeader, ChainPoint (..), ScriptHash, ShelleyAddr, TxId)
import Cardano.Api qualified as C
import Cardano.Api.Shelley qualified as C
import Cardano.Ledger.Alonzo qualified as Alonzo
import Cardano.Ledger.Alonzo.Data qualified as Data
import Cardano.Ledger.Credential qualified as L
import Cardano.Ledger.Crypto qualified as C
import Cardano.MuesliSwapOrderValidator.OrderValidator (OrderAction (..), orderScript)
import Codec.Serialise qualified as Codec
import Convex.Event (ResolvedInputs, TxWithEvents, extractAlonzoTxn')
import Data.ByteString.Base16 qualified as Base16
import Data.ByteString.Lazy qualified as BSL
import Data.Maybe (fromMaybe)
import Data.Proxy (Proxy (..))
import Data.Text (Text)
import Ledger.Scripts qualified as P
import Plutus.V1.Ledger.Api qualified as Plutus

-- | Versions of the muesli contract.
data MuesliVersion = MuesliV1
  deriving stock (Eq, Ord, Show)

fullMatchRedeemer :: C.ScriptRedeemer
fullMatchRedeemer = C.fromAlonzoData @(Alonzo.AlonzoEra C.StandardCrypto) $ Data.Data $ Plutus.builtinDataToData $ Plutus.toBuiltinData FullMatch

{-| Address of the muesli swap script (v2) on mainnet.
@addr1wy2mjh76em44qurn5x73nzqrxua7ataasftql0u2h6g88lc3gtgpz@
-}
muesliAddr :: Address ShelleyAddr
muesliAddr = fromMaybe (error "muesliAddr") $ C.deserialiseAddress (C.AsAddress C.AsShelleyAddr) "addr1wy2mjh76em44qurn5x73nzqrxua7ataasftql0u2h6g88lc3gtgpz"

{-| @15b95fdaceeb507073a1bd198803373beeafbd82560fbf8abe9073ff@
-}
muesliHash :: ScriptHash
muesliHash = case muesliAddr of
  C.ShelleyAddress _ (C.fromShelleyPaymentCredential -> C.PaymentCredentialByScript h) _ -> h
  _                                                                                      -> error "muesliHash"

muesliVersion :: ScriptHash -> Maybe MuesliVersion
muesliVersion sh | sh == muesliHash = Just MuesliV1
muesliVersion _                     = Nothing

-- first block with v2:
-- Hash f90517fd9fb9194b1ef6f9c1d147c0f175c3b29604542692e3d06bf13403aacf
-- 6559251
-- https://explorer.cardano.org/de/block?id=f90517fd9fb9194b1ef6f9c1d147c0f175c3b29604542692e3d06bf13403aacf
muesliStart :: ChainPoint
muesliStart = fromMaybe (error "muesliStart") $ do
  hsh <- C.deserialiseFromRawBytesHex (AsHash (C.proxyToAsType (Proxy :: Proxy BlockHeader))) "f90517fd9fb9194b1ef6f9c1d147c0f175c3b29604542692e3d06bf13403aacf"
  return $ ChainPoint 46_536_192 hsh

minDepositLovelace :: Integer
minDepositLovelace = 1_500_000 -- 1.5 Ada

handlingFeeLovelace :: Integer
handlingFeeLovelace = 600_000 -- 0.6 Ada

muesliScript :: C.PlutusScript C.PlutusScriptV1
muesliScript = fromMaybe (error "muesliScript") $ toCardanoPlutusScript orderScript

toCardanoPlutusScript :: P.Script -> Maybe (C.PlutusScript C.PlutusScriptV1)
toCardanoPlutusScript = C.deserialiseFromRawBytes (C.AsPlutusScript C.AsPlutusScriptV1) . BSL.toStrict . Codec.serialise

-- one that was picked up: 83d57c36d3235e307b6fa20b57942b83984c5ef0c0cb9758148e9902a8645772
interestingTx0 :: TxId
interestingTx0 = "83d57c36d3235e307b6fa20b57942b83984c5ef0c0cb9758148e9902a8645772"

interestingTx0Tx :: C.Tx C.AlonzoEra
interestingTx0Tx = either (error . show) id $
  C.deserialiseFromCBOR (C.AsTx C.AsAlonzoEra) $ Base16.decodeLenient $ BSL.toStrict interestingTx0Serialised

interestingTx0TxEvents :: ([TxWithEvents MuesliVersion], ResolvedInputs MuesliVersion)
interestingTx0TxEvents =
  extractAlonzoTxn'
    mempty
    muesliVersion
    (C.BlockHeader 1 blockHash 1)
    interestingTx0Tx

interestingTx1 :: TxId
interestingTx1 = "bd6dc9d8bb33620616070f7fcf5ecbae30d458addf42ad8feec025dd6e8fd5d4"

{-| A tx that was missed by the event extraction code. This produces one of the inputs of interestingTx1
-}
interestingTx2 :: TxId
interestingTx2 = "63e156de94ff0491440c50b8a22c5066783c9c9a6cab9e2f47660f616ab460bf"

interestingTx2Tx :: C.Tx C.AlonzoEra
interestingTx2Tx = either (error . show) id $
  C.deserialiseFromCBOR (C.AsTx C.AsAlonzoEra) $ Base16.decodeLenient $ BSL.toStrict interestingTx2Serialised

getStakingKey :: Text -> Maybe (L.StakeReference C.StandardCrypto)
getStakingKey serialised = do
  addr <- C.deserialiseAddress (C.AsAddress C.AsShelleyAddr) serialised
  case addr of
    C.ShelleyAddress _ _ stakeRef -> Just stakeRef

blockHash :: C.Hash BlockHeader
blockHash = fromMaybe (error "block header") $
  C.deserialiseFromRawBytesHex (C.proxyToAsType $ Proxy @(C.Hash C.BlockHeader)) "bd6dc9d8bb33620616070f7fcf5ecbae30d458addf42ad8feec025dd6e8fd5d4"

interestingTx2TxEvents :: ([TxWithEvents MuesliVersion], ResolvedInputs MuesliVersion)
interestingTx2TxEvents =
  extractAlonzoTxn'
    mempty
    muesliVersion
    (C.BlockHeader 1 blockHash 1)
    interestingTx2Tx

interestingTx1Tx :: C.Tx C.AlonzoEra
interestingTx1Tx = either (error . show) id $
  C.deserialiseFromCBOR (C.AsTx C.AsAlonzoEra) $ Base16.decodeLenient $ BSL.toStrict interestingTx1Serialised

interestingTx1TxEvents :: ([TxWithEvents MuesliVersion], ResolvedInputs MuesliVersion)
interestingTx1TxEvents =
  extractAlonzoTxn'
    (snd interestingTx2TxEvents <> snd interestingTx0TxEvents)
    muesliVersion
    (C.BlockHeader 1 blockHash 1)
    interestingTx1Tx

firstDanglingMatchTx :: TxId
firstDanglingMatchTx = "faaf9c25ca225a24842ea9c051ee37dbb2d2ef56cdf904faeea9be79154b1b5f"

firstDanglingMatchTxTx :: C.Tx C.AlonzoEra
firstDanglingMatchTxTx = either (error . show) id $
  C.deserialiseFromCBOR (C.AsTx C.AsAlonzoEra) $ Base16.decodeLenient $ BSL.toStrict firstDanglingMatchTxSerialised

firstDanglingMatchTxEvents :: ([TxWithEvents MuesliVersion], ResolvedInputs MuesliVersion)
firstDanglingMatchTxEvents =
  extractAlonzoTxn'
    (snd firstDanglingMatchScriptInput1TxEvents <> snd firstDanglingMatchScriptInput2TxEvents)
    muesliVersion
    (C.BlockHeader 1 blockHash 1)
    firstDanglingMatchTxTx

-- {_inputs = fromList
-- [ TxIn (TxId {_unTxId = SafeHash "6abcdbbf56e6614708f22c8a53593a11335eaac6ad536c79c072e675e92b7a73"}) 0 -- script in
-- , TxIn (TxId {_unTxId = SafeHash "73b039169388c0cba19e6857d3b7c9fa9d92b737f3351d1644aff24b98ef9b6d"}) 0
-- , TxIn (TxId {_unTxId = SafeHash "73b039169388c0cba19e6857d3b7c9fa9d92b737f3351d1644aff24b98ef9b6d"}) 3
-- , TxIn (TxId {_unTxId = SafeHash "ebeb897e2677fbc4f15fc004e50d7aff872d33e8043e501fe10f26112b429907"}) 0 -- script in
-- ],

firstDanglingMatchScriptInput1 :: TxId
firstDanglingMatchScriptInput1 = "6abcdbbf56e6614708f22c8a53593a11335eaac6ad536c79c072e675e92b7a73" -- this is the one we see

firstDanglingMatchScriptInput1Tx :: C.Tx C.AlonzoEra
firstDanglingMatchScriptInput1Tx = either (error . show) id $
  C.deserialiseFromCBOR (C.AsTx C.AsAlonzoEra) $ Base16.decodeLenient $ BSL.toStrict firstDanglingMatchScriptInput1TxSerialised

firstDanglingMatchScriptInput1TxEvents :: ([TxWithEvents MuesliVersion], ResolvedInputs MuesliVersion)
firstDanglingMatchScriptInput1TxEvents =
  extractAlonzoTxn'
    mempty
    muesliVersion
    (C.BlockHeader 1 blockHash 1)
    firstDanglingMatchScriptInput1Tx

firstDanglingMatchScriptInput2 :: TxId
firstDanglingMatchScriptInput2 = "ebeb897e2677fbc4f15fc004e50d7aff872d33e8043e501fe10f26112b429907" -- this is the one we don't see

firstDanglingMatchScriptInput2TxEvents :: ([TxWithEvents MuesliVersion], ResolvedInputs MuesliVersion)
firstDanglingMatchScriptInput2TxEvents =
  extractAlonzoTxn'
    mempty
    muesliVersion
    (C.BlockHeader 1 blockHash 1)
    firstDanglingMatchScriptInput2Tx

firstDanglingMatchScriptInput2Tx :: C.Tx C.AlonzoEra
firstDanglingMatchScriptInput2Tx = either (error . show) id $
  C.deserialiseFromCBOR (C.AsTx C.AsAlonzoEra) $ Base16.decodeLenient $ BSL.toStrict firstDanglingMatchScriptInput2TxSerialised

interestingTx1Serialised :: BSL.ByteString
interestingTx1Serialised = "84a6008382582063e156de94ff0491440c50b8a22c5066783c9c9a6cab9e2f47660f616ab460bf00825820701fae4684ca0e17c5a22fc557dd5e548f6fc29f464ad29e9cbe978c935d6e190082582083d57c36d3235e307b6fa20b57942b83984c5ef0c0cb9758148e9902a8645772000d81825820701fae4684ca0e17c5a22fc557dd5e548f6fc29f464ad29e9cbe978c935d6e1900018482581d61b346445ea6a7061b1c465ce047c4982256ca1add1e9f1af261e81d991a0140fb2482583901d93cd003a2e9a69ccd8586d467c3b8c0869357222df8d1588eb11a81385241e0543f2af35855aca280919f5db7fa6acb548d9b8f45caa0bf821a0016e360a1581c1d7f33bd23d85e1a25d87d86fac4f199c3197a2f7afeb662a0f34e1ea150776f726c646d6f62696c65746f6b656e1a000f424082583901d3ed652c6384d8d72553e7a1409c8b1711ad8a77890fc8c9f4507e3fbaeac466194541f30999de24924de393c7f3e642302c8a56d0aab66b1a00325aa082581d61b346445ea6a7061b1c465ce047c4982256ca1add1e9f1af261e81d991a23beb220021a000ef34b0e800b5820b17e8b61bf11977a8cc5e0c725fbec943d9aa54168897b0d36759f96a4daf9bba40081825820fb30992c1e52c5a3ac0e13052a2344224087355ee493184b27268988f6c663f95840e1f28cc758788a55e01ab9025dbff14e4b72208e52819f67fc551dca1bbf202dda0594571fcb8ea0171fbb4b05d9109e286b3971af0a7e25edd19ae34cd8840b03815911ed5911ea010000332333222332233223322332232323332223233322232333333332222222232333222323333222232323322323332223233322232323322332232323333322222332233223322332233223322223223223232533530333330083333573466e1cd55cea8032400046460a000264646464646666ae68cdc39aab9d5004480008cccc8888cccc16c01000c008004dd71aba15004375c6ae85400cdd71aba15002375a6ae84d5d1280111a8279a982819ab9c491035054310005149926135744a00226ae8940044d55cf280089baa001357426aae79401c8d4124d4c128cd5ce2481035054310004b499263333573466e1d40112002205323333573466e1d40152000205523504a35304b335738921035054310004c49926498cccd5cd19b8735573aa004900011980599191919191919191919191999ab9a3370e6aae754029200023333333333019335027232323333573466e1cd55cea8012400046603e60746ae854008c0b0d5d09aba2500223505935305a3357389201035054310005b49926135573ca00226ea8004d5d0a80519a8138141aba150093335502e75ca05a6ae854020ccd540b9d728169aba1500733502704335742a00c66a04e66aa0a8098eb4d5d0a8029919191999ab9a3370e6aae754009200023350213232323333573466e1cd55cea80124000466a05266a084eb4d5d0a80118239aba135744a00446a0ba6a60bc66ae712401035054310005f49926135573ca00226ea8004d5d0a8011919191999ab9a3370e6aae7540092000233502733504275a6ae854008c11cd5d09aba2500223505d35305e3357389201035054310005f49926135573ca00226ea8004d5d09aba2500223505935305a3357389201035054310005b49926135573ca00226ea8004d5d0a80219a813bae35742a00666a04e66aa0a8eb88004d5d0a801181c9aba135744a00446a0aa6a60ac66ae71241035054310005749926135744a00226ae8940044d5d1280089aba25001135744a00226ae8940044d5d1280089aba25001135573ca00226ea8004d5d0a8011919191999ab9a3370ea00290031180f181d9aba135573ca00646666ae68cdc3a801240084603a608a6ae84d55cf280211999ab9a3370ea00690011180e98181aba135573ca00a46666ae68cdc3a80224000460406eb8d5d09aab9e50062350503530513357389201035054310005249926499264984d55cea80089baa001357426ae8940088d4124d4c128cd5ce249035054310004b49926104a1350483530493357389201035054350004a4984d55cf280089baa001135573a6ea80044dd50009109198008018011000911111111109199999999980080580500480400380300280200180110009109198008018011000891091980080180109000891091980080180109000891091980080180109000909111180200290911118018029091111801002909111180080290008919118011bac0013200135503b2233335573e0024a01c466a01a60086ae84008c00cd5d100101991919191999ab9a3370e6aae75400d200023330073232323333573466e1cd55cea8012400046601a60626ae854008cd404c0b4d5d09aba25002235036353037335738921035054310003849926135573ca00226ea8004d5d0a801999aa805bae500a35742a00466a01eeb8d5d09aba25002235032353033335738921035054310003449926135744a00226aae7940044dd50009110919980080200180110009109198008018011000899aa800bae75a224464460046eac004c8004d540d488c8cccd55cf80112804919a80419aa81898031aab9d5002300535573ca00460086ae8800c0b84d5d08008891001091091198008020018900089119191999ab9a3370ea002900011a80418029aba135573ca00646666ae68cdc3a801240044a01046a0526a605466ae712401035054310002b499264984d55cea80089baa001121223002003112200112001232323333573466e1cd55cea8012400046600c600e6ae854008dd69aba135744a00446a0466a604866ae71241035054310002549926135573ca00226ea80048848cc00400c00880048c8cccd5cd19b8735573aa002900011bae357426aae7940088d407cd4c080cd5ce24810350543100021499261375400224464646666ae68cdc3a800a40084a00e46666ae68cdc3a8012400446a014600c6ae84d55cf280211999ab9a3370ea00690001280511a8111a981199ab9c490103505431000244992649926135573aa00226ea8004484888c00c0104488800844888004480048c8cccd5cd19b8750014800880188cccd5cd19b8750024800080188d4068d4c06ccd5ce249035054310001c499264984d55ce9baa0011220021220012001232323232323333573466e1d4005200c200b23333573466e1d4009200a200d23333573466e1d400d200823300b375c6ae854014dd69aba135744a00a46666ae68cdc3a8022400c46601a6eb8d5d0a8039bae357426ae89401c8cccd5cd19b875005480108cc048c050d5d0a8049bae357426ae8940248cccd5cd19b875006480088c050c054d5d09aab9e500b23333573466e1d401d2000230133016357426aae7940308d407cd4c080cd5ce2481035054310002149926499264992649926135573aa00826aae79400c4d55cf280109aab9e500113754002424444444600e01044244444446600c012010424444444600a010244444440082444444400644244444446600401201044244444446600201201040024646464646666ae68cdc3a800a400446660106eb4d5d0a8021bad35742a0066eb4d5d09aba2500323333573466e1d400920002300a300b357426aae7940188d4040d4c044cd5ce2490350543100012499264984d55cea80189aba25001135573ca00226ea80048488c00800c888488ccc00401401000c80048c8c8cccd5cd19b875001480088c018dd71aba135573ca00646666ae68cdc3a80124000460106eb8d5d09aab9e500423500a35300b3357389201035054310000c499264984d55cea80089baa001212230020032122300100320011122232323333573466e1cd55cea80124000466aa016600c6ae854008c014d5d09aba25002235007353008335738921035054310000949926135573ca00226ea8004498480048004448848cc00400c008448004848c0040088004888848cccc00401401000c00880044880084880048004448c8c00400488cc00cc008008004c8ccc888c8c8cc88cc88ccc888c8c8c8c8cc88c8c8cc88c8cccc8888c8c8c8c8c8c8c8c8ccc888c8ccc888ccc888cccccccc88888888cc88ccccc88888cccc8888cc88cc88cc88ccc888cc88cc88cc88cc88cc88c8c8c8cc88c8c8c8c8c8c8cc88c8c8c8c8c8c8cc888c888c8c94cd4c1240104cc0352401297369676e617475726520646f6573206e6f74206d617463682063726561746f7220696e20646174756d0033223530200022222222222533535032333553068120015027253353079333573466e3c0300041ec1e84d40d4004540d000c841ec41e54008c04540144cc054cc03524012f65787065637465642063726561746f7220746f2067657420616c6c206f66207768617420736865206f72646572656400330153350133335500e305c12001504f350481223335501b2253353070333505006353353502a3235302900122335304c0022350300012502f300e00221001132635300b335738920117696e76616c6964207075626c6963206b657920686173680000c498c05540244cc010c0340080044004004c8d4c08400488888888880254010ccd41354138c1894014c04920c08db7013350133335500e305c12001504f350481223335501b22533530703005002133004335506500d30100020011001001300d5004333504d504e30625005333504d504e533535026301a00321300a300d0011630124830236dc04cc0352401276f6e6c79206d617463686573206f66207061697273206f66206f726465727320616c6c6f77656400533535063350481223335501b225335307030050021330040020011001001300d50041306a162215335350650011306c16221533535067001107222130701623253353502732353024001222001500121333504e223530280022235302a0032232335304e0052335304f004253353077333573466e3c0080041e41e05400c41e081e08cd4c13c01081e094cd4c1dcccd5cd19b8f002001079078150031078153353502e0032153353502f00221335304c0022335304d002233530510022335305200223306d002001207b23353052002207b23306d00200122207b222335304f004207b2225335307c333573466e1c01800c1f81f454cd4c1f0ccd5cd19b8700500207e07d1333573466e1c0100041f81f441f441f441d854cd4d40b8004841d841d8c03140094cd4d40a0c07001484cd54190034c03c0045841b84c0300044d4c068004880084d4c02800480044800480048d4c0680048880088d4c06400488800c8d4c05000488888888880288d4c05400488004894cd4c184004418c4cd5ce001031089119aa8011a82600090009091800801100091a982c0009111002119a82999aa82b245003350533355056489000015054505412233355304b120013500550032353550560012233355304e120013500850062353550590012233353550490012330614800000488cc1880080048cc184005200000133040002001133500400105a22533530590021001105a123350492233353500400322002002001353500200122001122123300100300212001112232001320013550582253353504e00110032213300600230040012353003001223530070022222222222533335302600b21501b21501b21501b2133355305012001500f2353015001225335306353353063333573466e3cd4c0bc00888008d4c0bc010880081941904ccd5cd19b8735302f0022200135302f00422001065064106413501f0031501e00b13350432253353500d002210031001500c2212330010030022001222222222212333333333300100b00a009008007006005004003002200122123300100300220012221233300100400300220012212330010030022001121223002003112200112001122123300100300212001122123300100300212001122123300100300212001121222300300411222002112220011200121222230040052122223003005212222300200521222230010052001221233001003002200121222222230070082212222222330060090082122222223005008122222220041222222200322122222223300200900822122222223300100900820012122300200322212233300100500400320012122300200321223001003200112335001501d501e1220021220012001120011200113002012133500b2233300301300200150162223355300e1200123535501a00122335501d002335530111200123535501d001223355020002333535500d00123300a4800000488cc02c0080048cc028005200000133004002001223355300c1200123535501800122335501b00233353550080012335530101200123535501c00122335501f00235500f001001223335550080150020012335530101200123535501c00122335501f00235500d0010013335550030100020011112223335530041200150153355300c1200123535501800122335501b00235500b0013335530041200122353550190022253353021333553011120013500d33500f22533530230021025100102223535501c001223300a0020050061003133501900400350160013355300c120012353550180012232335501c00330010053200135502322533535019001135500b0032213535501e00222533530263300c00200813355010007001130060030023200135501c221122253353501500110022213300500233355300712001005004001112122230030041122122233002005004112122230010041120011233500722333535004003220020020013535002001220011221233001003002120013200135501422112253353500c0011500e22133500f3004002335530061200100400132001355013221122253353500c00113535006003220012213335350080052200230040023335530071200100500400112212330010030021200122333573466e3c00800404404088cdc000100088911801000919991119a80319aa80480199a80319aa804801000a803a8039a980380091110019a980380091110011a98038009111000889100109109119800802001890008891091980080180108900091110919998008028020018011000900211199ab9a3371000400200800a2440042440024002224646002002446600660040040030482d8799fd8799f581cd93cd003a2e9a69ccd8586d467c3b8c0869357222df8d1588eb11a81581c1d7f33bd23d85e1a25d87d86fac4f199c3197a2f7afeb662a0f34e1e50776f726c646d6f62696c65746f6b656e1a000f4240ffffd8799fd8799f581cd3ed652c6384d8d72553e7a1409c8b1711ad8a77890fc8c9f4507e3f40401a001b7740ffff0582840000d87a80821a00354d661a46446720840002d87a80821a0036d0861a480eaca4f5f6"

interestingTx0Serialised :: BSL.ByteString
interestingTx0Serialised = "84a400888258201a66c21596e25f8bb44160a5cac04a803cf6f1cc9cdca739a740bd39538f2f24008258203dceda07bbc95aff3340ec68ffd986b4945150945117e1e0c31dddafa073d01c02825820a44984fcdebc9a8b442e2452c92846effc9b7ceffc755f93449f4e8868f0f4a702825820366fd0dfcec7761520417c61010fd904a07bc1759b107bee61523c31238f8e9900825820c25fed097efe492101f8fd35626f28308190363190aced0ff119083c2405609c01825820c2fa9f75cea5b33a47bf5f9fc347005c7dfc1ac9cd64156edaf7c02e68241e06008258203dceda07bbc95aff3340ec68ffd986b4945150945117e1e0c31dddafa073d01c018258209e26f142695f669f45cb09ffba9ddcbd2b41d6df9d3744fb8b5dc896d747283500018283581d7115b95fdaceeb507073a1bd198803373beeafbd82560fbf8abe9073ff1a23e351205820136ba1670f39d9d6dca5a2934fb87e901c492bcad5979b8ff37add655358d19382583901d93cd003a2e9a69ccd8586d467c3b8c0869357222df8d1588eb11a81385241e0543f2af35855aca280919f5db7fa6acb548d9b8f45caa0bf821a10d2c292b81b581c08606a8373e62b0dd72ffbf84696b44adec82e192518743fa7a0971dae4a41444148454144313233014a41444148454144333037014a41444148454144333234014a41444148454144373030014a41444148454144373036014a41444148454144373533014a41444148454144383133014a41444148454144383634014a41444148454144393235014b4144414845414431303233014b4144414845414431303830014b4144414845414431303939014b4144414845414431323337014b414441484541443132363001581c0a85dd1543465407852c90e66c074a3b52ea2d7c77a2346ddc20550aa1514e46545530303534457175696e6531313201581c15509d4cb60f066ca4c7e982d764d6ceb4324cb33776d1711da1beeea14e42616279416c69656e303331363401581c377a6e2c13dcc66598a69db4922c6b8f2df8aa7546987dd444e50eeea14c434d4554414c414e4431583101581c3c2cfd4f1ad33678039cfd0347cca8df363c710067d739624218abc0a351576f726c647357697468696e30383036370151576f726c647357697468696e30383739360151576f726c647357697468696e313139373901581c48766b78dbb52c7fc4617acf4503a9f40b2f0fb3448ba0ab0e1fda09a14c5374696b4672696b3339373201581c4bf184e01e0f163296ab253edd60774e2d34367d0e7b6cbc689b567da2525061766961506c7573313132506c7573353301525061766961506c757333364d696e7573353201581c515d65633be064683e5de278c8a082330c626a5ce011e92c2a3b013da158194d69636861656c4a6f7264616e4e42414c6567656e6473313001581c59900ce5e717093bc3b802bfcfe6777de2dcc47b984e2d633d21cc8ea14652304b4f424501581c5bb7f3c67cb9bece3ae0f654ec5eed2f8c0b16ecd18e66157392eb3ca15543617264616e6f4b69647a3030363446433033313901581c60c57180d0693ea74e3425991a97c5b9252b01ce8c8f4248290c40cea156647261676f6e62617a7a65797363617266656573303201581c752d20731a3dccff3c148a5ed1a7b5610482889f91e7abcb1f356bc4a246436f736d50360147436f736d50323901581c8634f3bf5cd864c4b661ff25789ae0154b34084d431c222d242bc39ca54c48415a45476f6775656e3134014c4d494c4c4368696172613231015048415a45416e74686f6e794d6344303201504e4f4d41444e6963686f6c6974613131015150524f4d454e414445476f6775656e303901581c884892bcdc360bcef87d6b3f806e7f9cd5ac30d999d49970e7a903aea145504156494119208d581c892c886d77956d94f0581cac1671bc71ea3d9ccace232e97d38d8b3ea1454a5244303101581c90465e141ecb7b72ed0cdbcbd848673177cd52be5af5518e95d0de1da14b33444547454e533430323901581c9d627f74f7ddce42ab7ee23f4301f709198c14712deb2460ebf2a177a145415244303101581ca578222022f3e69511ff1931cb93517ac4902626e308f25665a6c5b4a14b4e42414c6567656e64733801581cb2c11cce7f5b964ba1e09b517a9ea382a174a0a88842f755888b528aa14d49766f7279466c6f776572313401581cb5240b3ae40bca2cc56b0fdfd7553724ccd18c56a98937d6b6f76265a1504164615265616c6d506c6f743436373501581cb863bc7369f46136ac1048adb2fa7dae3af944c3bbb2be2f216a8d4fa14d4265727279566972696469616e01581cca9c8dfd333240b3c5124c6ed6c46cac2c26c404861d8f4a34200970a1534e4654553030303257617272696f727330303601581ccfcc08e6a1882855292f72482d778966b3350a6b0e91a9a184fe6848a1535268696e6f47656e65726174696f6e3134393901581cd5e6bf0500378d4f0da4e8dde6becec7621cd8cbf5cbb9b87013d4cca14c53706163654275643835303301581cd9c840c6c317712114502d04609f761238d4436c905fcf215cff8216a1564461696c79446f736553706163654275647a3939353401581cdb9092a340fa079b9ec6066b646046efc0f846e96abf7eeb5f3959e0a15153757065724f47486f6c6465723032393701581cdcc6a0ff77d4e79950a83d60e8e1cd000b0a464d37506cbc1d1a54aeaa4d436f726e47616e673030313231014d436f726e47616e673031323632014d436f726e47616e673034323536014d436f726e47616e673036333030014d436f726e47616e673036373736014d436f726e47616e673038333438014d436f726e47616e673038343930014d436f726e47616e673039303136014d436f726e47616e673039303935014d436f726e47616e67303935383501021a00040dad075820ac953cff92b27ce75a375a01e77503fbe2b6188375841cd3c3ca11e76d91639ca100818258202001b687bfa64cf3f8a818796e19552f03f6053daf08fe4f7a9308def68eb4455840004541ed5cb52fc895d43a058699177328bfa4b3ece8a8d66ec5ff35588e1656ba149f81af06788d456c10c14bce921f828b556202b0b6f128c3b7e894282f04f5a61903e8583901d93cd003a2e9a69ccd8586d467c3b8c0869357222df8d1588eb11a81385241e0543f2af35855aca280919f5db7fa6acb548d9b8f45caa0bf1903e9783864393363643030336132653961363963636438353836643436376333623863303836393335373232326466386431353838656231316138311903ea783831643766333362643233643835653161323564383764383666616334663139396333313937613266376166656236363261306633346531651903eb70776f726c646d6f62696c65746f6b656e1903ec67313030303030301903ed1a00200b20"

interestingTx2Serialised :: BSL.ByteString
interestingTx2Serialised = "84a4008182582089a6d7d081bae139e90f7b19b153c7d2ac1464303b897d8c56adeaa0c8e28fe201018283581d7115b95fdaceeb507073a1bd198803373beeafbd82560fbf8abe9073ff821a00200b20a1581c1d7f33bd23d85e1a25d87d86fac4f199c3197a2f7afeb662a0f34e1ea150776f726c646d6f62696c65746f6b656e1a000f42405820e8334fe72ab474fe61990e0fe37c4b17d528919b5ef0c268377947800538f9e382583901d3ed652c6384d8d72553e7a1409c8b1711ad8a77890fc8c9f4507e3fbaeac466194541f30999de24924de393c7f3e642302c8a56d0aab66b821a071e9dcba1581c1d7f33bd23d85e1a25d87d86fac4f199c3197a2f7afeb662a0f34e1ea150776f726c646d6f62696c65746f6b656e1a06dac2c0021a0002c431075820bbce6b382689f25820a4146ab51bf54c25c0097363f942e184182efa129cb9b9a100818258203d2d1208777ef846035b3e80d383ce8a8e50b9eb3d8783f1062b414fbbcf371c5840c00da23cc89d63564acb9cf5f950c5f4de8dd4ffee59d262d2dac099a097f395d2f8252d6cd6c31e5867e15b89c4eacba7cbb9a5337124d925dfe38234b96307f5a61903e8583901d3ed652c6384d8d72553e7a1409c8b1711ad8a77890fc8c9f4507e3fbaeac466194541f30999de24924de393c7f3e642302c8a56d0aab66b1903e9783864336564363532633633383464386437323535336537613134303963386231373131616438613737383930666338633966343530376533661903ea601903eb601903ec67313830303030301903ed1a00200b20"

firstDanglingMatchTxSerialised :: BSL.ByteString
firstDanglingMatchTxSerialised = "84a600848258206abcdbbf56e6614708f22c8a53593a11335eaac6ad536c79c072e675e92b7a730082582073b039169388c0cba19e6857d3b7c9fa9d92b737f3351d1644aff24b98ef9b6d0082582073b039169388c0cba19e6857d3b7c9fa9d92b737f3351d1644aff24b98ef9b6d03825820ebeb897e2677fbc4f15fc004e50d7aff872d33e8043e501fe10f26112b429907000d8282582073b039169388c0cba19e6857d3b7c9fa9d92b737f3351d1644aff24b98ef9b6d0082582073b039169388c0cba19e6857d3b7c9fa9d92b737f3351d1644aff24b98ef9b6d03018482581d615e05df52517097df7aa734cfd8f7c127df3909e5085a5dddc91aeea91a0023061082583901c6be62306e601822b6c765324493caefd97f1486dd444f1871b2c7d16e5abc70d6750d3566293d75b028131bde041a0887b9f06313184303821a0016e360a1581ca0028f350aaabe0545fdcb56b039bfb08e4bb4d8c4d7c3c7d481c235a145484f534b591a000f424082583901ab44f02fe9d2c953a4a75957c2e88cc0563c83670733915fc233aa0405e4aac116d3ea30ec2f85f8ed6ff11be45daddf8431fcf7f37d5aa11a002625a082581d615e05df52517097df7aa734cfd8f7c127df3909e5085a5dddc91aeea91a00a1be40021a000fd7860e800b5820a56490ee8d75f1a2b4b51c388e07a253dd019456e2807d7480babe0e95553088a40081825820c16d6407d3ec27f6ab08015375f18c84763e3f5e4e08fbd0a0d00cacc60998215840b6fd2564bed124ea57168c0d860d8d1ec78f74ad571af8ac3c2c4a0e3957d47bf60376ea0c691081b9feb26d10962e3552204af7a688431259af758329299d0903815911ed5911ea010000332333222332233223322332232323332223233322232333333332222222232333222323333222232323322323332223233322232323322332232323333322222332233223322332233223322223223223232533530333330083333573466e1cd55cea8032400046460a000264646464646666ae68cdc39aab9d5004480008cccc8888cccc16c01000c008004dd71aba15004375c6ae85400cdd71aba15002375a6ae84d5d1280111a8279a982819ab9c491035054310005149926135744a00226ae8940044d55cf280089baa001357426aae79401c8d4124d4c128cd5ce2481035054310004b499263333573466e1d40112002205323333573466e1d40152000205523504a35304b335738921035054310004c49926498cccd5cd19b8735573aa004900011980599191919191919191919191999ab9a3370e6aae754029200023333333333019335027232323333573466e1cd55cea8012400046603e60746ae854008c0b0d5d09aba2500223505935305a3357389201035054310005b49926135573ca00226ea8004d5d0a80519a8138141aba150093335502e75ca05a6ae854020ccd540b9d728169aba1500733502704335742a00c66a04e66aa0a8098eb4d5d0a8029919191999ab9a3370e6aae754009200023350213232323333573466e1cd55cea80124000466a05266a084eb4d5d0a80118239aba135744a00446a0ba6a60bc66ae712401035054310005f49926135573ca00226ea8004d5d0a8011919191999ab9a3370e6aae7540092000233502733504275a6ae854008c11cd5d09aba2500223505d35305e3357389201035054310005f49926135573ca00226ea8004d5d09aba2500223505935305a3357389201035054310005b49926135573ca00226ea8004d5d0a80219a813bae35742a00666a04e66aa0a8eb88004d5d0a801181c9aba135744a00446a0aa6a60ac66ae71241035054310005749926135744a00226ae8940044d5d1280089aba25001135744a00226ae8940044d5d1280089aba25001135573ca00226ea8004d5d0a8011919191999ab9a3370ea00290031180f181d9aba135573ca00646666ae68cdc3a801240084603a608a6ae84d55cf280211999ab9a3370ea00690011180e98181aba135573ca00a46666ae68cdc3a80224000460406eb8d5d09aab9e50062350503530513357389201035054310005249926499264984d55cea80089baa001357426ae8940088d4124d4c128cd5ce249035054310004b49926104a1350483530493357389201035054350004a4984d55cf280089baa001135573a6ea80044dd50009109198008018011000911111111109199999999980080580500480400380300280200180110009109198008018011000891091980080180109000891091980080180109000891091980080180109000909111180200290911118018029091111801002909111180080290008919118011bac0013200135503b2233335573e0024a01c466a01a60086ae84008c00cd5d100101991919191999ab9a3370e6aae75400d200023330073232323333573466e1cd55cea8012400046601a60626ae854008cd404c0b4d5d09aba25002235036353037335738921035054310003849926135573ca00226ea8004d5d0a801999aa805bae500a35742a00466a01eeb8d5d09aba25002235032353033335738921035054310003449926135744a00226aae7940044dd50009110919980080200180110009109198008018011000899aa800bae75a224464460046eac004c8004d540d488c8cccd55cf80112804919a80419aa81898031aab9d5002300535573ca00460086ae8800c0b84d5d08008891001091091198008020018900089119191999ab9a3370ea002900011a80418029aba135573ca00646666ae68cdc3a801240044a01046a0526a605466ae712401035054310002b499264984d55cea80089baa001121223002003112200112001232323333573466e1cd55cea8012400046600c600e6ae854008dd69aba135744a00446a0466a604866ae71241035054310002549926135573ca00226ea80048848cc00400c00880048c8cccd5cd19b8735573aa002900011bae357426aae7940088d407cd4c080cd5ce24810350543100021499261375400224464646666ae68cdc3a800a40084a00e46666ae68cdc3a8012400446a014600c6ae84d55cf280211999ab9a3370ea00690001280511a8111a981199ab9c490103505431000244992649926135573aa00226ea8004484888c00c0104488800844888004480048c8cccd5cd19b8750014800880188cccd5cd19b8750024800080188d4068d4c06ccd5ce249035054310001c499264984d55ce9baa0011220021220012001232323232323333573466e1d4005200c200b23333573466e1d4009200a200d23333573466e1d400d200823300b375c6ae854014dd69aba135744a00a46666ae68cdc3a8022400c46601a6eb8d5d0a8039bae357426ae89401c8cccd5cd19b875005480108cc048c050d5d0a8049bae357426ae8940248cccd5cd19b875006480088c050c054d5d09aab9e500b23333573466e1d401d2000230133016357426aae7940308d407cd4c080cd5ce2481035054310002149926499264992649926135573aa00826aae79400c4d55cf280109aab9e500113754002424444444600e01044244444446600c012010424444444600a010244444440082444444400644244444446600401201044244444446600201201040024646464646666ae68cdc3a800a400446660106eb4d5d0a8021bad35742a0066eb4d5d09aba2500323333573466e1d400920002300a300b357426aae7940188d4040d4c044cd5ce2490350543100012499264984d55cea80189aba25001135573ca00226ea80048488c00800c888488ccc00401401000c80048c8c8cccd5cd19b875001480088c018dd71aba135573ca00646666ae68cdc3a80124000460106eb8d5d09aab9e500423500a35300b3357389201035054310000c499264984d55cea80089baa001212230020032122300100320011122232323333573466e1cd55cea80124000466aa016600c6ae854008c014d5d09aba25002235007353008335738921035054310000949926135573ca00226ea8004498480048004448848cc00400c008448004848c0040088004888848cccc00401401000c00880044880084880048004448c8c00400488cc00cc008008004c8ccc888c8c8cc88cc88ccc888c8c8c8c8cc88c8c8cc88c8cccc8888c8c8c8c8c8c8c8c8ccc888c8ccc888ccc888cccccccc88888888cc88ccccc88888cccc8888cc88cc88cc88ccc888cc88cc88cc88cc88cc88c8c8c8cc88c8c8c8c8c8c8cc88c8c8c8c8c8c8cc888c888c8c94cd4c1240104cc0352401297369676e617475726520646f6573206e6f74206d617463682063726561746f7220696e20646174756d0033223530200022222222222533535032333553068120015027253353079333573466e3c0300041ec1e84d40d4004540d000c841ec41e54008c04540144cc054cc03524012f65787065637465642063726561746f7220746f2067657420616c6c206f66207768617420736865206f72646572656400330153350133335500e305c12001504f350481223335501b2253353070333505006353353502a3235302900122335304c0022350300012502f300e00221001132635300b335738920117696e76616c6964207075626c6963206b657920686173680000c498c05540244cc010c0340080044004004c8d4c08400488888888880254010ccd41354138c1894014c04920c08db7013350133335500e305c12001504f350481223335501b22533530703005002133004335506500d30100020011001001300d5004333504d504e30625005333504d504e533535026301a00321300a300d0011630124830236dc04cc0352401276f6e6c79206d617463686573206f66207061697273206f66206f726465727320616c6c6f77656400533535063350481223335501b225335307030050021330040020011001001300d50041306a162215335350650011306c16221533535067001107222130701623253353502732353024001222001500121333504e223530280022235302a0032232335304e0052335304f004253353077333573466e3c0080041e41e05400c41e081e08cd4c13c01081e094cd4c1dcccd5cd19b8f002001079078150031078153353502e0032153353502f00221335304c0022335304d002233530510022335305200223306d002001207b23353052002207b23306d00200122207b222335304f004207b2225335307c333573466e1c01800c1f81f454cd4c1f0ccd5cd19b8700500207e07d1333573466e1c0100041f81f441f441f441d854cd4d40b8004841d841d8c03140094cd4d40a0c07001484cd54190034c03c0045841b84c0300044d4c068004880084d4c02800480044800480048d4c0680048880088d4c06400488800c8d4c05000488888888880288d4c05400488004894cd4c184004418c4cd5ce001031089119aa8011a82600090009091800801100091a982c0009111002119a82999aa82b245003350533355056489000015054505412233355304b120013500550032353550560012233355304e120013500850062353550590012233353550490012330614800000488cc1880080048cc184005200000133040002001133500400105a22533530590021001105a123350492233353500400322002002001353500200122001122123300100300212001112232001320013550582253353504e00110032213300600230040012353003001223530070022222222222533335302600b21501b21501b21501b2133355305012001500f2353015001225335306353353063333573466e3cd4c0bc00888008d4c0bc010880081941904ccd5cd19b8735302f0022200135302f00422001065064106413501f0031501e00b13350432253353500d002210031001500c2212330010030022001222222222212333333333300100b00a009008007006005004003002200122123300100300220012221233300100400300220012212330010030022001121223002003112200112001122123300100300212001122123300100300212001122123300100300212001121222300300411222002112220011200121222230040052122223003005212222300200521222230010052001221233001003002200121222222230070082212222222330060090082122222223005008122222220041222222200322122222223300200900822122222223300100900820012122300200322212233300100500400320012122300200321223001003200112335001501d501e1220021220012001120011200113002012133500b2233300301300200150162223355300e1200123535501a00122335501d002335530111200123535501d001223355020002333535500d00123300a4800000488cc02c0080048cc028005200000133004002001223355300c1200123535501800122335501b00233353550080012335530101200123535501c00122335501f00235500f001001223335550080150020012335530101200123535501c00122335501f00235500d0010013335550030100020011112223335530041200150153355300c1200123535501800122335501b00235500b0013335530041200122353550190022253353021333553011120013500d33500f22533530230021025100102223535501c001223300a0020050061003133501900400350160013355300c120012353550180012232335501c00330010053200135502322533535019001135500b0032213535501e00222533530263300c00200813355010007001130060030023200135501c221122253353501500110022213300500233355300712001005004001112122230030041122122233002005004112122230010041120011233500722333535004003220020020013535002001220011221233001003002120013200135501422112253353500c0011500e22133500f3004002335530061200100400132001355013221122253353500c00113535006003220012213335350080052200230040023335530071200100500400112212330010030021200122333573466e3c00800404404088cdc000100088911801000919991119a80319aa80480199a80319aa804801000a803a8039a980380091110019a980380091110011a98038009111000889100109109119800802001890008891091980080180108900091110919998008028020018011000900211199ab9a3371000400200800a2440042440024002224646002002446600660040040030482d8799fd8799f581cab44f02fe9d2c953a4a75957c2e88cc0563c83670733915fc233aa0440401a000f4240ffffd8799fd8799f581cc6be62306e601822b6c765324493caefd97f1486dd444f1871b2c7d1581ca0028f350aaabe0545fdcb56b039bfb08e4bb4d8c4d7c3c7d481c23545484f534b591a000f4240ffff0582840000d87a80821a003ac0461a4d7b64c0840003d87a80821a00393d261a4bb1212af5f6"

firstDanglingMatchScriptInput1TxSerialised :: BSL.ByteString
firstDanglingMatchScriptInput1TxSerialised = "84a400818258201c951d59036cdf512727f59dd460a70d36f5e56da4794972b7602fcaeac9a41a00018283581d7115b95fdaceeb507073a1bd198803373beeafbd82560fbf8abe9073ff1a00b59460582010a31bdd165f24386b09a940d48dfc1be7e799682b022c74ffcd21d00ef0897b82583901c6be62306e601822b6c765324493caefd97f1486dd444f1871b2c7d16e5abc70d6750d3566293d75b028131bde041a0887b9f063131843031a00464038021a0002ba9107582095db1bab7dd708bbe2be51e637e095272be2b06a48ce83ae28dfe32d2d74385da10081825820d4e88f59b1496801bfb2c22c05a9014a370f1a32e10a5ee89432d38e98f735fb584081014b0abde78b6078c42cc963a076f6ba9771d8c4226e66414dd29dbd2a3bc798e1b3af5a5c743c15ae41f94204797a21ea45709447c200facb07c054548c08f5a51903e8583901c6be62306e601822b6c765324493caefd97f1486dd444f1871b2c7d16e5abc70d6750d3566293d75b028131bde041a0887b9f063131843031903e9783863366265363233303665363031383232623663373635333234343933636165666439376631343836646434343466313837316232633764311903ea783861303032386633353061616162653035343566646362353662303339626662303865346262346438633464376333633764343831633233351903eb65484f534b591903ec6731303030303030" -- this is the one we see

firstDanglingMatchScriptInput2TxSerialised :: BSL.ByteString
firstDanglingMatchScriptInput2TxSerialised = "84a4008282582049d1599ebe8f8f83bf32f086e4f9a14e0798a1b19ca553bdf2e7155fdad26e3c018258202dfa620fbce479c5c6d4083c90475ec002cfc2db1f2f6157ee7d3cbfd63b0ecc02018283581d7115b95fdaceeb507073a1bd198803373beeafbd82560fbf8abe9073ff821a001cfde0a1581ca0028f350aaabe0545fdcb56b039bfb08e4bb4d8c4d7c3c7d481c235a145484f534b591a000f4240582007de4efcb1a2c45e388a95d79fd85906d1732e86eed6f3fe8b1440cf8948453c82583901ab44f02fe9d2c953a4a75957c2e88cc0563c83670733915fc233aa0405e4aac116d3ea30ec2f85f8ed6ff11be45daddf8431fcf7f37d5aa1821a002d9228a1581ca0028f350aaabe0545fdcb56b039bfb08e4bb4d8c4d7c3c7d481c235a145484f534b591a0856efea021a0002c539075820d2eb4281e3591bc3cfc5fd79a082ac45d3073ffd030b529a4e4ece185a1d3d16a10081825820303e198f87cfc6fb4679ce45cd7eead2f206a6e50c154a114a91f174d3963a005840429ad46bf690d98d124b77a8b65b40c11bdac65924185f11482c14c423883660e748589446597426dc7d901a717a4c16fe278fb3777e6dd3ebdcae5edc77f00bf5a51903e8583901ab44f02fe9d2c953a4a75957c2e88cc0563c83670733915fc233aa0405e4aac116d3ea30ec2f85f8ed6ff11be45daddf8431fcf7f37d5aa11903e9783861623434663032666539643263393533613461373539353763326538386363303536336338333637303733333931356663323333616130341903ea601903eb601903ec6731303030303030" -- this is the one we don't see
